---
title: Lab 4
author: Hunter Rose, Tanner Boyle
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
```

```{r}
defense <- read_excel('cyclonesFootball2019.xlsx', sheet='Defensive')
offense <- read_excel('cyclonesFootball2019.xlsx', sheet='Offensive')
bio <- read_excel('cyclonesFootball2019.xlsx', sheet='Biography')
```

```{r}
defense$Name <- as.factor(defense$Name)
offense$Name <- as.factor(offense$Name)
bio$Name <- as.factor(bio$Name)
```

```{r}
defClean <- defense %>%
  mutate_at(.var = vars(Tackles_Solo, Tackles_ASST, Tackles_TFL, Tackles_Sack, Turnover_FF, Turnover_FR,
          Turnover_INT, Pass_QBH, Pass_PB),
            .funs = funs(as.numeric))

offense <- offense %>% 
  rename(Passing_CMPATT = `Passing_CMP-ATT`) %>% 
  mutate(Passing_CMPATT = gsub(" ", "", Passing_CMPATT),
         Passing_CMPATT = gsub("-\r\n", "", Passing_CMPATT))

offense <- offense %>% 
  separate(Passing_CMPATT,
           into = c("Passing_CMP", "Passing_ATT"),
           sep = 2)

offense %>% 
  filter(Name == "Purdy, Brock") %>% 
  head()

offClean <- offense %>%
  mutate_at(.var = vars(Rushing_ATT, Rushing_YDS, Rushing_TD, Receiving_REC, Receiving_YDS, Receiving_TD,
              Passing_CMP, Passing_ATT, Passing_YDS, Passing_TD, Passing_INT),
            .funs = funs(as.numeric))
bio %>%
  separate(Height, c('feet', 'inches'), "-", convert = TRUE) %>%
  mutate(cm = (12*feet +inches) * 2.54)
bioClean <- bio %>%
  mutate_at(.var = vars(Weight, Height),
            .funs = funs(as.numeric))

head(offClean)
head(defClean)
head(bioClean)
```

```{r}
defClean <- defClean %>% 
  pivot_longer(Tackles_Solo:Pass_PB, names_to = "Statistic", values_to = "Value")

defClean %>% 
  head()

defClean %>% 
  ggplot(aes(x=Value)) +
  geom_histogram(binwidth=0.5) +
  facet_wrap(~Statistic)

```

### All statistics other than Solo/Asst Tackles are relatively rare but the most rare statistics would be the three turnover statistics. 

```{r}
defClean2 <- defClean %>% 
  filter(Statistic == "Tackles_Solo",
         Opponent_Opponent %in% c("West Virginia", "Kansas State")) %>% 
  select(Name, Opponent_Opponent, Value) %>%
  pivot_wider(names_from = Opponent_Opponent, values_from = Value) %>% 
  drop_na()

defClean2 %>%
	head()

defClean2 %>%
  ggplot(aes(x=`West Virginia`, y=`Kansas State`)) + geom_point()
```

```{r}
off_HT <- bioClean %>%
  select(Name) %>%
  right_join(bioClean, offClean, by="Name")
head(off_HT)
```

```{r}
weight_YDS <- merge(offClean, bioClean, by="Name")
weight_YDS %>%
  group_by(Name) %>%
  select(Name, Receiving_YDS, Weight) %>%
  ggplot(aes(x=Weight, y=Receiving_YDS)) + geom_point() + geom_smooth(method=lm)
```

### The regression line shows that there is a slight increase in receiving yards while increasing in weight. 

```{r}
purdy_stats <- offClean %>%
  filter(Name == "Purdy, Brock") %>%
  select(Rushing_YDS, Passing_YDS, Opponent_Opponent) %>%
  mutate(total_yds = Rushing_YDS + Passing_YDS)



team_stats <- offClean %>%
  filter(Name != "Purdy, Brock") %>%
  select(Rushing_YDS, Passing_YDS, Opponent_Opponent) %>%
  drop_na() %>%
  mutate(total_yds = Rushing_YDS + Passing_YDS)


total_stats <- right_join(purdy_stats, team_stats, by = "Opponent_Opponent")

total_stats %>%
  select(total_yds.x, total_yds.y, Opponent_Opponent) %>%
  mutate(total_team_yds = total_yds.x + total_yds.y)
```
Brock Purdy is the main source of yards for the ISU offense. If he doesn't perform well, the entire offense will be performing poorly. 